### What

- XSS（Cross Site Scripting）是指从外部向网页注入脚本，然后脚本在某种情况下被网页执行的一种漏洞攻击
- XSS 是一种注入攻击，注入攻击发生的原因是用户输入的数据被当成了程序来执行
- 核心：如何让目标页面被其他用户访问时，执行一段外部脚本
- 后果：攻击一旦成功就可以实现 JS 能实现的任何事情，从而实现窃取信息、滥发广告等非法获利的目的
- XSS Worm 可以利用用户的交互行为进行传播，从而造成大面积危害
- 产生漏洞的关键点：输入点与输出点
- 分类
  + 反射型
    - 通常将 XSS 的 Payload 写在 URL 中，通过服务器或浏览器直接输出并执行
    - 通常需要诱使用户点击某个恶意链接，才能攻击成功
    - 因为不涉及存储，也称为非持久性 XSS
  + 存储型
    - 通常将 XSS 储存到服务器中（提交某种信息，比如评论、留言、文章等）
    - 其它用户浏览包含恶意脚本的网页，就会触发攻击
    - 也称为持久性 XSS
  + DOM Based XSS
    - 指输入输出全部在客户端完成的 XSS，可理解为反射型的一种特例

> 一切输入都是有害的


### How

基本思路：首先要找到一个存在漏洞或者可以绕过安全检测的输入点，注入脚本，然后还需要找到一个输出漏洞，让注入的脚本得到执行
<br>
<br>
常见输入点：
- 输入框
  + 想办法绕过长度限制
- 利用 location.hash 藏代码
- 利用 base 标签改变相对地址的最终路径

常见输出点
- HTML 标签、属性
- HTML 事件属性
- script 标签
- CSS：利用 CSS 中含有 url 的属性执行脚本代码
- 地址栏


### 措施

- HTTPOnly
- 输入检查
  + XXS Filter，通常会检测并过滤一些敏感字符（黑名单）
    - script、javascript
    - 特殊字符：< > ...
  + 问题是有可能把正常的输入也过滤掉了
  + 因此更妥当的办法不是过滤，而是替换，比如将某些半角符号转化为全角
  + 根据场景，还可以采用白名单的思路
- 输出检查
  + 方式：编码（Encode）或转义（Escape）
    - 输出到 HTML 的地方：HTMLEncode: `<` => `&lt;` | `\` => `&#x2F` ...
    - 输出到脚本的地方：JavaScriptEncode 
  + 对象
    - 变量
    - 特殊字符
- CSP
  + [Content Security Policy](https://jaq.alibaba.com/community/art/show?articleid=518)


### 真实案例

- [XSS实战：我是如何拿下你的百度账号](https://zhuanlan.zhihu.com/p/24249045)
