# Git

### æ ¸å¿ƒæ¦‚å¿µ

- å·¥ä½œåŒºï¼ˆworking directoryï¼‰
- æš‚å­˜åŒºï¼ˆindexï¼‰
- commit
    + git é‡‡ç”¨å…¨é‡è®°å½•çš„ç­–ç•¥æ¥ä¿å­˜æ¯ä¸ªç‰ˆæœ¬
    + æ¯ä¸ª commit å°±æ˜¯ä¸€ä¸ªç‰ˆæœ¬ï¼Œéƒ½ä»£è¡¨æ•´ä¸ªé¡¹ç›®æ‰€å¤„çš„ä¸€ä¸ªçŠ¶æ€
    + æ¯ä¸ª commit éƒ½åŒ…å«ä¸Šä¸€ä¸ª commit çš„å¼•ç”¨ï¼Œç”±æ­¤å½¢æˆä¸€æ¡é“¾

> å·¥ä½œåŒºã€æš‚å­˜åŒºã€commit éƒ½æ˜¯æ•´ä¸ªé¡¹ç›®çš„å®Œæ•´å‰¯æœ¬ï¼Œå¯ä»¥æŠ½è±¡æˆä¸‰é¢—ç‹¬ç«‹çš„æ ‘
> staged changes æ˜¯æš‚å­˜åŒºä¸ HEAD ä¸¤é¢—æ ‘ diff çš„ç»“æœ
> changes æ˜¯å·¥ä½œåŒºä¸æš‚å­˜åŒºè¿™ä¸¤é¢—æ ‘ diff çš„ç»“æœ


- HEADï¼šå¯¹å½“å‰åˆ†æ”¯æœ€åä¸€æ¬¡ commit çš„å¼•ç”¨
    + æŸ¥çœ‹ HEAD çš„ commit ä¿¡æ¯ï¼š`git cat-file -p HEAD`
    + æŸ¥çœ‹ HEAD çš„æ–‡ä»¶å¿«ç…§ï¼š`git ls-tree -r HEAD`
    + HEAD çš„çˆ¶èŠ‚ç‚¹ï¼š`HEAD~`
- åˆ†æ”¯ï¼šæŒ‡å‘æŸä¸ª commit çš„å¼•ç”¨

> åç¼€ ~ è¡¨ç¤ºçˆ¶èŠ‚ç‚¹ï¼Œ~n è¡¨ç¤ºç¬¬ n ä¸ªçˆ¶èŠ‚ç‚¹ï¼Œ[å‚è€ƒ](https://stackoverflow.com/questions/2221658/whats-the-difference-between-head-and-head-in-git)

```js
// git é»˜è®¤åˆ›å»º master å¼•ç”¨ï¼ŒæŒ‡å‘æŸä¸ª commit
// commit-a <-- master <-- HEAD
{
    master: 'commit-a'
}

// åˆ›å»ºåˆ†æ”¯ï¼Œå°±æ˜¯æ–°å¢å¼•ç”¨
// commit-a <-- master
//          <-- branch <-- HEAD
{
    master: 'commit-a',
    branch: 'commit-a'
}

// å½“å‰å¤„äºå“ªä¸ªåˆ†æ”¯ï¼Œæ˜¯ç”± HEAD å¼•ç”¨å†³å®šçš„ï¼Œæ¯”å¦‚åˆ‡å› master
// commit-a <-- master <-- HEAD
//          <-- branch
```


### æ–‡ä»¶çŠ¶æ€çš„æµè½¬

ç”¨ `git status -sï¼ˆ--shortï¼‰`å¯ä»¥çœ‹åˆ°ç”±ç¬¦å·è¡¨ç¤ºçš„çŠ¶æ€ã€‚ç¬¦å·æœ‰ä¸¤ä½ç½®ï¼Œå·¦è¾¹çš„æ˜¯æš‚å­˜åŒºå’Œä¸Šä¸€æ¬¡ commit æ¯”è¾ƒå¾—åˆ°çš„çŠ¶æ€ï¼Œå³è¾¹æ˜¯å·¥ä½œåŒºå’Œæš‚å­˜åŒºæ¯”è¾ƒå¾—åˆ°çš„çŠ¶æ€ã€‚çŠ¶æ€åªæœ‰å››ç§ï¼šæœªçŸ¥ã€æ–°å¢ã€ä¿®æ”¹ã€æ²¡å˜åŒ–

- æ–°å¢æ–‡ä»¶ Fï¼ˆuntrackedï¼‰ `??`
- `git add F`
- å·²æš‚å­˜ï¼ˆstaged new fileï¼‰ `A `
- `ä¿®æ”¹ F`
- å·²æš‚å­˜å’Œå·²ä¿®æ”¹ï¼ˆstaged new file & modifiedï¼‰`AM`
- `git commit`
- å·²ä¿®æ”¹ï¼ˆmodified & to be staged for commitï¼‰` M`
- `git add F`
- å·²ä¿®æ”¹ï¼ˆmodified & to be committedï¼‰`M `
- `git commit`
- å·²ä¿å­˜ ğŸ‘Œ
- `ä¿®æ”¹ F`
- å·²ä¿®æ”¹ï¼ˆmodified & to be staged for commitï¼‰` M`
- `git add F`
- å·²ä¿®æ”¹ï¼ˆmodified & to be committedï¼‰`M `
- `ä¿®æ”¹ F`
- å·²ä¿®æ”¹ï¼ˆmodified & to be committed & to be staged for commitï¼‰`MM`


### è®°å½•å˜æ›´

è®°å½•å˜æ›´æœ‰ä¸¤ä¸ªå‘½ä»¤ï¼šadd å’Œ commit

ä¸ºä»€ä¹ˆè¦è®¾è®¡æš‚å­˜åŒºï¼Ÿæš‚å­˜åŒºæœ¬è´¨ä¸Šæ˜¯å‡†å¤‡æ·»åŠ åˆ°ä¸‹ä¸€ä¸ª commit çš„å€™é€‰å†…å®¹ï¼Œæš‚å­˜åŒºå…è®¸ç”¨æˆ·æ›´çµæ´»çš„æ§åˆ¶å°†å“ªäº›å†…å®¹ä½œä¸ºä¸‹ä¸€ä¸ª commitã€‚æ¯”å¦‚å½“å‰ä¿®æ”¹äº† 10 ä¸ªæ–‡ä»¶ï¼Œä½†åªæŒ‘é€‰å…¶ä¸­ 3 ä¸ªä½œä¸ºä¸€æ¬¡ commit æäº¤ï¼Œå¦‚æœä¸­é€”åæ‚”ï¼Œè¿˜å¯ä»¥æ’¤å‡ºæŸä¸ªä¿®æ”¹ï¼Œå†å°†å‰©ä¸‹çš„ä½œä¸º commit æäº¤ã€‚

è¡¥æ¼ã€‚å¦‚æœè¿˜æƒ³å‘ä¸Šä¸€ä¸ª commit ç»§ç»­æ·»åŠ ä¸€äº›ä¸œè¥¿ï¼Œç”¨ `git commit --amend`

åˆå†™ï¼Œæ·»åŠ æš‚å­˜å¹¶æäº¤ï¼š`git commit -am"xxx"`


### æŸ¥çœ‹å†å²å˜æ›´è®°å½•


### æ’¤é”€æ›´æ”¹/åˆ é™¤è®°å½•

reset æœ¬è´¨æ˜¯åœ¨æ“æ§ HEADã€æš‚å­˜åŒºå’Œå·¥ä½œåŒºè¿™ä¸‰æ£µæ ‘

è¯­æ³•ï¼š`git reset [commit id] [file] --[mode]`

commit é»˜è®¤ä¸º HEADï¼Œfile é»˜è®¤ä¸ºç©ºï¼Œmode é»˜è®¤ä¸º mixed

`git reset` ä¸‰ç§æ¨¡å¼

- `--soft` ä»…ä»…ç§»åŠ¨/å˜æ›´ HEAD æŒ‡å‘
- `--mixed` ï¼ˆé»˜è®¤ï¼‰ç§»åŠ¨ HEAD æŒ‡å‘ï¼Œå¹¶å°† HEAD å¤åˆ¶åˆ°æš‚å­˜åŒºï¼Œç›¸å½“äºé‡ç½®æ•´ä¸ªæš‚å­˜åŒº
- `--hard` ç§»åŠ¨ HEAD æŒ‡å‘ï¼Œå¹¶å°† HEAD å¤åˆ¶åˆ°æš‚å­˜åŒºå’Œå·¥ä½œåŒºï¼Œç›¸å½“äºé‡ç½®æ•´ä¸ªæš‚å­˜åŒºå’Œå·¥ä½œåŒº

> å¦‚æœæ²¡æœ‰æŒ‡å®š fileï¼Œåˆ™æ•´ä½“å¤åˆ¶ï¼›è‹¥æŒ‡å®š fileï¼Œåˆ™ä»…å¤åˆ¶æ–‡ä»¶

å®ä¾‹ï¼š

- å–æ¶ˆæš‚å­˜ï¼š`git reset` or `git reset HEAD` or `git reset master`ï¼ˆå‡è®¾å½“å‰åœ¨ master åˆ†æ”¯ï¼‰
- å–æ¶ˆæŸä¸ªå·²æš‚å­˜æ–‡ä»¶ï¼š`git reset file`
- æ”¾å¼ƒä¸€éƒ¨åˆ† commitï¼Œä½†ä¸æ”¾å¼ƒæš‚å­˜å’Œå·¥ä½œåŒºçš„å˜æ›´ï¼š`git reset <id> --soft`
- å½»åº•æ”¾å¼ƒæ‰€æœ‰å˜æ›´ï¼Œå›åˆ°æŸä¸ª commitï¼š`git reset <id> --hard`
- æ’¤é”€å½“å‰çš„ mergeï¼š`git reset HEAD~ --hard`

æ ¹æ® reset çš„å·¥ä½œåŸç†ï¼Œæ˜¾ç„¶æ— æ³•ç”¨ reset å–æ¶ˆå½“å‰å°šæœªæš‚å­˜çš„æ›´æ”¹ï¼Œè§£å†³åŠæ³•æ˜¯ï¼šgit checkout

- å–æ¶ˆæŸä¸ªæ–‡ä»¶çš„å°šæœªæš‚å­˜çš„å˜æ›´ï¼š`git checkout <file>`ï¼Œå«ä¹‰æ˜¯ï¼šä»æš‚å­˜åŒºçš„æ ‘ä¸­å¤åˆ¶ file å¹¶è¦†ç›–å½“å‰çš„ file
- é‡ç½®æ•´ä¸ªå·¥ä½œåŒºï¼š`git checkout .`

å¦‚ä½•åˆ é™¤ä»»æ„æŸä¸ª commit å‘¢ï¼Ÿ



### æ¯”è¾ƒå·®å¼‚


### åˆ†æ”¯


### ä¸è¿œç¨‹äº¤äº’

åœ¨ä¼ä¸šé‡Œï¼Œgit ä»“åº“ç»“æ„ä¸€èˆ¬å¦‚ä¸‹ï¼ˆè¿œç¨‹ä»“åº“åªæœ‰ä¸€ä¸ªï¼‰

```
remote
  |-- local
  |-- local
  |-- local
  |-- ...
```

åœ¨ github ä¸Šï¼Œgit ä»“åº“ç»“æ„å¤§æ¦‚å¦‚ä¸‹ï¼ˆå¯¹æ¯ä¸ªæœ¬åœ°ä»“åº“è€Œè¨€ï¼Œè¿œç¨‹ä»“åº“æœ‰å¤šä¸ªï¼‰

```
origin -- local
  |
remote -- local
  |
remote -- local
  |
remote -- local
  | ...
```

æŸ¥çœ‹æ‰€æœ‰çš„è¿œç¨‹ä»“åº“ï¼š`git remote -v`

æ·»åŠ è¿œç¨‹ä»“åº“ï¼š`git remote add <shortname> <url>`

æ‹‰å–ä¸æ¨é€

- `git clone <url>`
- `git fetch [shortname]`
- `git pull [shortname>`
- `git push [remote-name] [branchname]`

> ä½¿ç”¨ clone å‘½ä»¤å…‹éš†ä¸€ä¸ªä»“åº“æ—¶ï¼Œå‘½ä»¤ä¼šè‡ªåŠ¨å°†å…¶æ·»åŠ ä¸ºè¿œç¨‹ä»“åº“å¹¶é»˜è®¤ä»¥ â€œoriginâ€ ä¸ºç®€å†™

å®ä¾‹

- å¦‚ä½•åˆ é™¤è¿œç¨‹çš„ commitï¼šåœ¨æœ¬åœ°åˆ é™¤ï¼Œç„¶å `git push origin +master` or `git push origin master -f`
